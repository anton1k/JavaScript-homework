"use strict";function listSorter(e){e.sort(function(e,n){var t=void 0,o=void 0;try{t=getBday(e.bdate),o=getBday(n.bdate)}catch(e){r=1,console.error(e.message)}finally{var i=t-o;return t||o||(i=1),i}})}function getBday(e){var r=e.split("."),n=new Date,t=new Date(n.getFullYear(),r[1]-1,r[0])-n,o=Math.floor(t/864e5);return o<0&&(o+=365),o}function declOfNum(e,r){return r[4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]}new Promise(function(e){"complete"===document.readyState?e():window.onload=e}).then(function(){return new Promise(function(r,n){VK.init({apiId:6628603}),VK.Auth.login(function(e){e.session?r(e):n(new Error("Не удалось авторизоваться"))},2)})}).then(function(){return new Promise(function(n,t){VK.api("users.get",{name_case:"gen",v:"5.80"},function(e){if(e.error)t(new Error(e.error.error_msg));else{var r=e.response[0];h1.textContent="Друзья "+r.first_name+" "+r.last_name,n(e)}})})}).then(function(){return new Promise(function(e,w){VK.api("friends.get",{fields:"photo_50, bdate",v:"5.80"},function(e){var r=e.response.items;if(e.error)w(new Error(e.error.error_msg));else{var n=!0,t=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,l=String(s.bdate),u=l.split("."),f=new Date(u[2],u[1],u[0]),c=new Date,d=c.getFullYear()-f.getFullYear();if(f.setFullYear(c.getFullYear()),c<f&&d--,"undefined"!=l&&5<l.length){var m=declOfNum(d,["год","года","лет"]);s.age=d+" "+m}}}catch(e){t=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(t)throw o}}listSorter(r);var g=friendsTpl.innerHTML,v=Handlebars.compile(g)({items:e.response.items});container.innerHTML=v}})})}).catch(function(e){alert("Ошибка "+e.message)});